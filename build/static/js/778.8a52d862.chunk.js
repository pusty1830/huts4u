"use strict";(self.webpackChunkhuts4u=self.webpackChunkhuts4u||[]).push([[778],{87778:(e,o,n)=>{n.r(o),n.d(o,{default:()=>S});var t=n(65043),i=n(83462),l=n(26600),r=n(35316),a=n(7353),d=n(94496),s=n(76641),c=n(11906),u=n(81637),x=n(68903),h=n(12110),g=n(26494),v=n(39336),m=n(59662),p=n(70579);const f=(0,m.A)((0,p.jsx)("path",{d:"m18 22-.01-6L14 12l3.99-4.01L18 2H6v6l4 4-4 3.99V22zM8 7.5V4h8v3.5l-4 4z"}),"HourglassBottom");var y=n(33580),b=n(67809),A=n(59628),k=n(69995),j=n(57488);const C=e=>{let{open:o,handleClose:n,selectedCard:x,onSubmit:h}=e;const[g,v]=(0,t.useState)((null===x||void 0===x?void 0:x.rating)||0),[m,f]=(0,t.useState)((null===x||void 0===x?void 0:x.reviewText)||""),[A,k]=(0,t.useState)(!1);(0,t.useEffect)((()=>{v((null===x||void 0===x?void 0:x.rating)||0),f((null===x||void 0===x?void 0:x.reviewText)||"")}),[x]);return(0,p.jsxs)(i.A,{open:o,onClose:n,fullWidth:!0,maxWidth:"sm",children:[(0,p.jsxs)(l.A,{sx:{fontWeight:700},children:["Review - ",(null===x||void 0===x?void 0:x.hotelName)||(null===x||void 0===x?void 0:x.title)||"Booking"]}),(0,p.jsx)(r.A,{children:(0,p.jsxs)(a.A,{display:"flex",flexDirection:"column",gap:2,mt:1,children:[(0,p.jsx)(d.A,{children:"Rate your experience:"}),(0,p.jsx)(s.A,{value:g,onChange:(e,o)=>v(o||0),size:"large"}),(0,p.jsx)(b.XY,{sx:{"& .MuiInputBase-input":{resize:"vertical"},"& textarea":{resize:"vertical"},"& .MuiOutlinedInput-root":{"& fieldset":{border:"none",borderRadius:"12px"}}},label:"Write your review",multiline:!0,rows:4,fullWidth:!0,value:m,onChange:e=>f(e.target.value)}),(0,p.jsxs)(a.A,{display:"flex",justifyContent:"flex-end",gap:2,children:[(0,p.jsx)(c.A,{onClick:n,variant:"outlined",sx:{textTransform:"none",borderRadius:"44px"},children:"Cancel"}),(0,p.jsx)(c.A,{onClick:async()=>{if(x){k(!0);try{await h(x.id,g,m),n()}finally{k(!1)}}},variant:"contained",sx:{background:y.A.firstColor,color:"white",textTransform:"none",borderRadius:"44px",px:3},disabled:A,children:A?(0,p.jsx)(u.A,{size:20,color:"inherit"}):"Submit Review"})]})]})})]})},S=()=>{const[e,o]=(0,t.useState)([]),[n,i]=(0,t.useState)(!1),[l,r]=(0,t.useState)(null),[m,b]=(0,t.useState)(!1),S=e=>{if(!e&&0!==e)return"\u20b90.00";let o=Number(e);return!isNaN(o)&&Math.abs(o)>1e3&&(o/=100),isNaN(o)?String(e):o.toLocaleString("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2})},w=e=>{const o=(e=>{try{if(!e)return null;if(e.checkInDateTime){const o=new Date(e.checkInDateTime);if(!isNaN(o.getTime()))return o}if(e.checkInDate){const o=String(e.checkInDate).replace(/[\u2018\u2019\u201C\u201D]/g,"'").trim(),n=e.checkInTime?String(e.checkInTime).trim():"",t=[`${o} ${n}`,`${o}T${n}`,o];for(const e of t){if(!e)continue;const o=new Date(e);if(!isNaN(o.getTime()))return o}const i=`${o.replace(/\u2019|\u2018|\u2019/g,"")} ${n}`.replace(/[\u2018\u2019\u201C\u201D]/g,""),l=new Date(i);if(!isNaN(l.getTime()))return l}return null}catch{return null}})(e);if(!o)return!1;const n=new Date,t=o.getTime()-n.getTime(),i=String((null===e||void 0===e?void 0:e.bookingType)||(null===e||void 0===e?void 0:e.type)||"").toLowerCase();return"hourly"===i||"hour"===i?t>9e5:t>864e5};(0,t.useEffect)((()=>{(async()=>{b(!0);try{var e,n;const t={data:{filter:"",userId:(0,A.F6)()},page:0,pageSize:50,order:[["createdAt","DESC"]]},i=await(0,k.Gc)(t),l=(null===i||void 0===i||null===(e=i.data)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.rows)||[];o(l)}catch(t){console.error("Failed to load bookings",t),j.oR.error("Failed to load bookings")}finally{b(!1)}})()}),[]),(0,t.useEffect)((()=>{if(!e||!e.length)return;const o=e.find((e=>"checkedOut"===String(e.status)&&(void 0===e.rating||null===e.rating)));o&&(r(o),i(!0))}),[e]);return m?(0,p.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",py:6},children:(0,p.jsx)(u.A,{})}):(0,p.jsxs)(a.A,{sx:{background:y.A.thirdColor,px:{xs:2,md:4},py:4},children:[(0,p.jsx)(d.A,{variant:"h4",fontWeight:"bold",sx:{textAlign:"center",color:y.A.firstColor,mb:2},children:"Your Bookings"}),(0,p.jsxs)(x.Ay,{container:!0,spacing:2,children:[0===e.length&&(0,p.jsx)(x.Ay,{item:!0,xs:12,children:(0,p.jsx)(a.A,{sx:{textAlign:"center",py:6},children:(0,p.jsx)(d.A,{sx:{color:"#666"},children:"No bookings yet."})})}),e.map(((e,n)=>{var t,l,u,m,b;const C=w(e),I=C?"Cancel booking":"hourly"===String((null===e||void 0===e?void 0:e.bookingType)||"").toLowerCase()||"hour"===String((null===e||void 0===e?void 0:e.bookingType)||"").toLowerCase()?"Hourly bookings can be cancelled only more than 15 minutes before start":"Bookings can be cancelled only more than 24 hours before check-in";return(0,p.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,p.jsx)(h.A,{sx:{margin:"auto",mt:2,p:{xs:2,md:3},boxShadow:"0px 8px 28px rgba(0,0,0,0.12)",borderRadius:"12px",border:`1px solid ${y.A.firstColor}`,position:"relative"},children:(0,p.jsxs)(g.A,{sx:{p:0},children:[(0,p.jsx)(a.A,{sx:{position:"absolute",top:{xs:8,md:8},right:{xs:16,md:16},background:"checked in"===e.status||"checked out"===e.status?"green":"pending"===e.status?"#faaf00":"red",color:"white",px:1,borderRadius:{xs:"6px",md:"8px"},py:.5,display:"flex",alignItems:"center",gap:1,fontSize:"12px",textTransform:"capitalize"},children:e.status}),(0,p.jsx)(d.A,{variant:"h6",sx:{fontWeight:700,mb:.5},children:(null===e||void 0===e?void 0:e.hotelName)||(null===e||void 0===e?void 0:e.propertyName)||(null===e||void 0===e?void 0:e.title)}),(0,p.jsxs)(d.A,{color:"textSecondary",sx:{fontSize:13},children:[null===e||void 0===e?void 0:e.checkInDate," ",null!==e&&void 0!==e&&e.checkInTime?`, ${e.checkInTime}`:""," ",null!==e&&void 0!==e&&e.guestName?`\xb7 ${e.guestName}`:""]}),(0,p.jsxs)(d.A,{sx:{mt:1},children:[null!==(l=null===e||void 0===e?void 0:e.adults)&&void 0!==l?l:1," Adults",null!==e&&void 0!==e&&e.children?`, ${e.children} Child`:""]}),(0,p.jsx)(d.A,{variant:"h6",sx:{mt:1},children:S(null!==(u=null!==(m=null===e||void 0===e?void 0:e.amountPaid)&&void 0!==m?m:null===e||void 0===e?void 0:e.amount)&&void 0!==u?u:0)}),(0,p.jsx)(v.A,{sx:{my:1.5,borderStyle:"dashed",borderColor:"grey"}}),"checkedOut"===e.status&&(0,p.jsxs)(a.A,{display:"flex",alignItems:"center",gap:2,mt:1,flexWrap:"wrap",children:[(0,p.jsx)(c.A,{sx:{background:"transparent",border:"solid 2px",color:y.A.firstColor,borderColor:y.A.firstColor,borderRadius:"44px",textTransform:"none"},onClick:()=>(e=>{r(e),i(!0)})(e),children:e.rating?"Edit Review":"Add Review"}),(0,p.jsx)(s.A,{value:null!==(b=e.rating)&&void 0!==b?b:0,readOnly:!0,size:"small"})]}),"pending"===e.status&&(0,p.jsxs)(a.A,{display:"flex",alignItems:"flex-start",mt:2,color:"#faaf00",children:[(0,p.jsx)(f,{}),(0,p.jsxs)(a.A,{sx:{ml:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[(0,p.jsx)(d.A,{children:"Upcoming"}),(0,p.jsx)(c.A,{sx:{background:"transparent",border:"solid 2px",color:y.A.firstColor,borderColor:y.A.firstColor,borderRadius:"44px",textTransform:"none",ml:2},onClick:()=>(async e=>{if(console.log(e),!w(e))return void j.oR.info("hourly"===(null===e||void 0===e?void 0:e.bookingType)||"hour"===(null===e||void 0===e?void 0:e.bookingType)?"Hourly bookings can only be cancelled more than 15 minutes before start.":"Bookings can only be cancelled more than 24 hours before check-in.");const n=e.status;o((o=>o.map((o=>o.id===e.id?{...o,status:"cancelled"}:o))));try{const o={paymentId:e.paymentId,amount:e.amountPaid};(0,k.WD)(o).then((o=>{var n,t;console.log(o);const i={userId:(0,A.F6)(),hotelId:e.hotelId,bookingId:e.id,amount:e.ammountPaid,refundAmount:e.ammountPaid,reason:"Guest requested cancellation",status:"pending",refundres:null===o||void 0===o||null===(n=o.data)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.refund,processedBy:1,refundedAt:"2025-12-04T08:00:00.000Z",currency:"INR"};console.log(i),(0,k.ik)(e.id,{status:"Cancel"}).then((o=>{const n={data:{filter:"",bookingId:e.id},page:0,pageSize:50,order:[["createdAt","ASC"]]};(0,k.E5)(n).then((e=>{var o,n;(0,k.k)(null===e||void 0===e||null===(o=e.data)||void 0===o||null===(n=o.data)||void 0===n?void 0:n.rows[0].id,{status:"cancelled"}).then((e=>{console.log("payout updated successfully ")}))}));const t={data:{filter:"",bookingId:e.id},page:0,pageSize:50,order:[["createdAt","ASC"]]};(0,k.Al)(t).then((e=>{var o,n,t;(0,k.QJ)(null===e||void 0===e||null===(o=e.data)||void 0===o||null===(n=o.data)||void 0===n||null===(t=n.rows[0])||void 0===t?void 0:t.id,{status:"cancelled"}).then((e=>{console.log("Payment cancelled successfully ")}))})),(0,k.xd)(i).then((e=>{j.oR.success("Booking cancelled")}))}))})).catch((e=>{console.log(e)}))}catch(t){o((o=>o.map((o=>o.id===e.id?{...o,status:n}:o)))),j.oR.error("Failed to cancel booking. Please try again.")}})(e),disabled:!C,title:I,children:"Cancel"})]})]}),"cancelled"===e.status&&(0,p.jsx)(a.A,{mt:2,color:"red",children:(0,p.jsx)(d.A,{children:"Booking Cancelled"})})]})})},null!==(t=e.id)&&void 0!==t?t:n)}))]}),l&&(0,p.jsx)(C,{open:n,handleClose:()=>{i(!1),r(null)},selectedCard:l,onSubmit:async(n,t,i)=>{o((e=>e.map((e=>String(e.id)===String(n)?{...e,rating:t,reviewText:i}:e))));try{const l=e.find((e=>String(e.id)===String(n))),r={userId:(0,A.F6)(),hotelId:(null===l||void 0===l?void 0:l.hotelId)||(null===l||void 0===l?void 0:l.hotelId)||(null===l||void 0===l?void 0:l.hotelId),bookingId:n,rating:Number(t),comment:i||""},a=await(0,k.GS)(r);if(null!==a&&void 0!==a&&a.data){const e=a.data;o((o=>o.map((o=>{var l,r;return String(o.id)===String(n)?{...o,rating:null!==(l=e.rating)&&void 0!==l?l:t,reviewText:null!==(r=e.comment)&&void 0!==r?r:i,hasRated:!0}:o}))))}j.oR.success("Thanks for your review!")}catch(l){console.error("Failed to submit rating:",l),o((e=>e.map((e=>String(e.id)===String(n)?{...e,rating:void 0,reviewText:void 0}:e)))),j.oR.error((null===l||void 0===l?void 0:l.message)||"Failed to submit review. Please try again.")}}})]})}}}]);
//# sourceMappingURL=778.8a52d862.chunk.js.map