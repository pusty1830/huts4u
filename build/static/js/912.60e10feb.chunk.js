"use strict";(self.webpackChunkhuts4u=self.webpackChunkhuts4u||[]).push([[912],{8881:(e,t,n)=>{n.d(t,{A:()=>f});var i=n(65043),o=n(7353),s=n(94496),r=n(53193),l=n(11906),a=n(79650),d=n(61596),c=n(71806),h=n(84882),u=n(28076),x=n(10039),g=n(73460),v=n(81045),A=n(43845),j=n(33580),m=n(69995),p=n(70579);const f=e=>{let{bookings:t=[],hotelId:n,onCheckIn:f,onCheckOut:b}=e;const[y,k]=(0,i.useState)(null),[w,C]=(0,i.useState)(!1),[S,I]=(0,i.useState)(t),[R,z]=(0,i.useState)([]);(0,i.useEffect)((()=>{I(t)}),[t]),(0,i.useEffect)((()=>{let e=!0;if(n)return C(!0),(0,m.hb)(n).then((t=>{var n,i,o;if(!e)return;const s=null!==(n=null===t||void 0===t||null===(i=t.data)||void 0===i||null===(o=i.data)||void 0===o?void 0:o.roomAvailable)&&void 0!==n?n:"Unavailable";k(s)})).catch((()=>{e&&k("Unavailable")})).finally((()=>{e&&C(!1)})),()=>{e=!1};k(null)}),[n]);const N=e=>{const t=(e.status||"").toLowerCase();return"pending"===t||"booked"===t},D=e=>"checkedin"===(e.status||"").toLowerCase(),W=(e,t)=>{z((n=>t?n.includes(e)?n:[...n,e]:n.filter((t=>t!==e))))},E=e=>{const t=e.toLowerCase();return"checkedin"===t?"rgba(163,228,215,0.8)":"checkedout"===t?"rgba(245,183,177,0.9)":"rgba(0,0,0,0.08)"},T=async(e,t)=>{const n=S.map((e=>({...e})));W(e,!0),I((n=>n.map((n=>n.id===e?{...n,status:t,statusColor:E(t)}:n))));try{await(0,m.ik)(e,{status:t}),"checkedIn"===t?null===f||void 0===f||f(e):"checkedOut"===t&&(null===b||void 0===b||b(e))}catch(i){console.error("Failed to update booking status",i),I(n)}finally{W(e,!1)}};return(0,p.jsxs)(o.A,{sx:{padding:2,background:j.A.thirdColor,boxShadow:"0px 0px 14px rgba(0, 0, 0, 0.14)",borderRadius:"12px"},children:[(0,p.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(s.A,{variant:"h6",fontWeight:"bold",children:"New bookings"}),(0,p.jsx)(s.A,{variant:"body2",color:"gray",children:S.length>0?"Recent guest reservations list":"No bookings found"})]}),(0,p.jsx)(r.A,{sx:{width:"fit-content",color:j.A.firstColor},children:(0,p.jsx)(l.A,{variant:"contained",color:"Available"===y?"success":"error",onClick:()=>{if(!n||null==y)return;const e=y,t="Available"===y?"Unavailable":"Available";k(t),(0,m.hI)(n,{roomAvailable:t}).then((()=>{console.log("Availability updated to",t)})).catch((t=>{console.error("Error updating availability:",t),k(e)}))},disabled:!n||w,sx:{textTransform:"none"},children:null!==y&&void 0!==y?y:w?"Loading...":"Unavailable"})})]}),S.length>0?(0,p.jsx)(a.A,{component:d.A,sx:{marginTop:2,boxShadow:"none",maxHeight:420},children:(0,p.jsxs)(c.A,{"aria-label":"bookings table",sx:{background:j.A.thirdColor},stickyHeader:!0,children:[(0,p.jsx)(h.A,{children:(0,p.jsx)(u.A,{children:["Booking ID","Guest name","Phone Number","Checked In Date","Checked In Time","Checked Out Date","Checked Out Time","Status","Actions"].map((e=>(0,p.jsx)(x.A,{sx:{fontWeight:"bold",color:"gray",fontSize:"14px",whiteSpace:"nowrap"},children:e},e)))})}),(0,p.jsx)(g.A,{children:S.map((e=>{var t,n,i,r,a,d,c,h,g,m,f;const b=R.includes(e.id);return(0,p.jsxs)(u.A,{sx:{border:"none"},children:[(0,p.jsx)(x.A,{sx:{verticalAlign:"middle"},children:e.id}),(0,p.jsx)(x.A,{children:(0,p.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,p.jsx)(v.A,{src:e.avatar,alt:null!==(t=e.geustName)&&void 0!==t?t:"guest"}),(0,p.jsx)(s.A,{children:null!==(n=e.geustName)&&void 0!==n?n:"Guest"})]})}),(0,p.jsxs)(x.A,{children:["+",null!==(i=null===e||void 0===e||null===(r=e.geustDetails)||void 0===r?void 0:r.phoneNumber)&&void 0!==i?i:"-"]}),(0,p.jsx)(x.A,{children:null!==(a=e.checkInDate)&&void 0!==a?a:"-"}),(0,p.jsx)(x.A,{children:null!==(d=e.checkInTime)&&void 0!==d?d:"-"}),(0,p.jsx)(x.A,{children:null!==(c=e.checkOutDate)&&void 0!==c?c:"-"}),(0,p.jsx)(x.A,{children:null!==(h=e.checkOutTime)&&void 0!==h?h:"-"}),(0,p.jsx)(x.A,{children:(0,p.jsx)(A.A,{label:null!==(g=e.status)&&void 0!==g?g:"unknown",sx:{backgroundColor:null!==(m=e.statusColor)&&void 0!==m?m:E(null!==(f=e.status)&&void 0!==f?f:""),color:"#000",fontWeight:"bold",textTransform:"capitalize"}})}),(0,p.jsx)(x.A,{children:(0,p.jsxs)(o.A,{display:"flex",gap:1,alignItems:"center",children:[(0,p.jsx)(l.A,{size:"small",variant:"contained",sx:{background:j.A.firstColor,textTransform:"none",borderRadius:"20px","&:disabled":{opacity:.6}},disabled:!N(e)||b,onClick:()=>T(e.id,"checkedIn"),children:b&&N(e)?"Processing...":"Check-In"}),(0,p.jsx)(l.A,{size:"small",variant:"outlined",sx:{color:j.A.firstColor,borderColor:j.A.firstColor,textTransform:"none",borderRadius:"20px","&:disabled":{opacity:.5}},disabled:!D(e)||b,onClick:()=>T(e.id,"checkedOut"),children:b&&D(e)?"Processing...":"Check-Out"})]})})]},e.id)}))})]})}):(0,p.jsx)(o.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",sx:{background:j.A.thirdColor},children:(0,p.jsx)(s.A,{variant:"body1",color:"textSecondary",children:"No bookings available for this hotel"})})]})}},64912:(e,t,n)=>{n.r(t),n.d(t,{default:()=>G});var i=n(51214),o=n(59662),s=n(70579);const r=(0,o.A)((0,s.jsx)("path",{d:"m14.43 10-1.47-4.84c-.29-.95-1.63-.95-1.91 0L9.57 10H5.12c-.97 0-1.37 1.25-.58 1.81l3.64 2.6-1.43 4.61c-.29.93.79 1.68 1.56 1.09l3.69-2.8 3.69 2.81c.77.59 1.85-.16 1.56-1.09l-1.43-4.61 3.64-2.6c.79-.57.39-1.81-.58-1.81h-4.45z"}),"StarRateRounded");var l=n(17953),a=n(94389),d=n(42796),c=n(7353),h=n(68903),u=n(94496),x=n(53193),g=n(57465),v=n(32143),A=n(11906),j=n(12110),m=n(26494),p=n(17392),f=n(39336),b=n(81045),y=n(50108),k=n(11653),w=n(87734),C=n(52185),S=n(6026),I=n(86150),R=n(90168),z=n(33580),N=n(8881),D=n(65043),W=n(69995),E=n(59628),T=n(73216),L=n(60446),M=n.n(L);const G=()=>{var e,t,n,o;const L=(0,T.Zp)(),[G,O]=(0,D.useState)([{name:"Dec 27",revenue:1e5},{name:"Jan 28",revenue:25e4},{name:"Feb 28",revenue:215060}]),[$,P]=(0,D.useState)([]),[F,H]=(0,D.useState)({}),[B,U]=(0,D.useState)(""),[Y,K]=(0,D.useState)(0),[J,V]=(0,D.useState)(""),[Z,q]=(0,D.useState)({}),[Q,X]=(0,D.useState)({}),[_,ee]=(0,D.useState)({});(0,D.useEffect)((()=>{(async()=>{const e={data:{filter:"",userId:(0,E.F6)()},page:0,pageSize:50,order:[["createdAt","ASC"]]};try{var t,n;const i=await(0,W.Vy)(e);if(null!==i&&void 0!==i&&null!==(t=i.data)&&void 0!==t&&null!==(n=t.data)&&void 0!==n&&n.rows){const e=i.data.data.rows.map((e=>{var t,n;return{id:e.id,name:null!==(t=null!==(n=e.propertyName)&&void 0!==n?n:e.name)&&void 0!==t?t:`Hotel ${e.id}`}}));return P(e),e.length>0&&(U((t=>t||e[0].id)),V((t=>t||e[0].id))),e.map((e=>e.id))}}catch(i){console.error("Error fetching hotels:",i)}return[]})().then((async e=>{await(async e=>{if(0===e.length)return;const t={};await Promise.all(e.map((async e=>{try{var n,i;const o={data:{filter:"",hotelId:e},page:0,pageSize:50,order:[["checkInDate","ASC"]]},s=await(0,W.Gc)(o);t[e]=(null===s||void 0===s||null===(n=s.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.rows)||[]}catch(o){console.error(`Error fetching bookings for hotel ${e}:`,o),t[e]=[]}}))),H(t)})(null!==e&&void 0!==e?e:[]),await te(),e&&e.length>0&&await Promise.all(e.map((e=>Promise.all([ne(e),ie(e)]))))}))}),[]),(0,D.useEffect)((()=>{B&&(ie(B),Z[B]||ne(B))}),[B]);const te=async()=>{try{var e,t,n,i,o,s,r,l;const a={data:{filter:"",userId:(0,E.F6)()},page:0,pageSize:100,order:[["createdAt","DESC"]]},d=await(0,W.Gc)(a),c=null!==(e=null!==(t=null===d||void 0===d||null===(n=d.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.count)&&void 0!==t?t:null===d||void 0===d||null===(o=d.data)||void 0===o||null===(s=o.data)||void 0===s?void 0:s.total)&&void 0!==e?e:Array.isArray(null===d||void 0===d||null===(r=d.data)||void 0===r||null===(l=r.data)||void 0===l?void 0:l.rows)?d.data.data.rows.length:0;K(null!==c&&void 0!==c?c:0)}catch(a){console.error("Error fetching new bookings count:",a),K(0)}},ne=async e=>{if(e)try{var t,n;const i={data:{filter:"",hotelId:e},page:0,pageSize:1e3,order:[["createdAt","DESC"]]},o=await(0,W.Ge)(i),s=(null===o||void 0===o||null===(t=o.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.rows)||[],r=s.length;let l=0;if(r>0){const e=s.reduce(((e,t)=>{var n,i;const o=Number(null!==(n=null!==(i=t.rating)&&void 0!==i?i:t.score)&&void 0!==n?n:0);return e+(isNaN(o)?0:o)}),0);l=+(e/r).toFixed(2)}q((t=>({...t,[e]:{avg:l,count:r}}))),X((t=>({...t,[e]:s})))}catch(i){console.error(`Error fetching ratings for hotel ${e}:`,i),q((t=>({...t,[e]:{avg:0,count:0}}))),X((t=>({...t,[e]:[]})))}},ie=async e=>{if(e)try{var t,n,i;const o={data:{filter:"",hotelId:e,status:{$ne:"cancelled"}},page:0,pageSize:1e3,order:[["createdAt","ASC"]]},s=await(0,W.E5)(o),r=null!==(t=null===s||void 0===s||null===(n=s.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.rows)&&void 0!==t?t:[];let l=0;const a=[];Array.isArray(r)&&r.length>0&&r.forEach(((e,t)=>{const n=Number(e.netAmountPaise||0)/100;l+=n;const i=e.createdAt?M()(e.createdAt).format("DD MMM"):`Rec ${t+1}`;a.push({name:i,revenue:n})})),ee((t=>({...t,[e]:{total:l}}))),a.length&&O(a)}catch(o){console.error(`Error fetching revenue for hotel ${e}:`,o)}},oe=e=>{const t=e.target.value;V(t),ne(t)},se=[{key:"newBookings",title:"New Bookings",value:Y,icon:(0,s.jsx)(i.A,{}),change:"8.70%",onClick:()=>{B&&L("/booking")},hoverText:"Go to Bookings"},{key:"guestRatings",title:"Guest ratings",value:Z[J]?`${Z[J].avg}/5`:"\u2014/5",icon:(0,s.jsx)(r,{}),change:"-3.56%",onClick:()=>{(J||B)&&L("/review")},hoverText:"Go to Reviews"},{key:"revenue",title:"Total Revenue",value:_[B]?`\u20b9${re=_[B].total,re.toLocaleString("en-IN",{maximumFractionDigits:0})}`:"\u20b90",icon:(0,s.jsx)(l.A,{}),change:"5.70%",onClick:()=>{B&&L("/hotel-payment")},hoverText:"Go to Payments"}];var re;return(0,s.jsx)(c.A,{p:3,sx:{background:z.A.thirdColor},children:(0,s.jsxs)(h.Ay,{container:!0,spacing:3,children:[(0,s.jsx)(h.Ay,{item:!0,xs:12,children:(0,s.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,s.jsx)(u.A,{variant:"h5",sx:{color:z.A.firstColor},children:"Hotel Dashboard"}),(0,s.jsxs)(c.A,{display:"flex",gap:2,alignItems:"center",children:[(0,s.jsx)(x.A,{sx:{minWidth:300},children:(0,s.jsx)(g.A,{value:null!==B&&void 0!==B?B:"",onChange:e=>U(e.target.value),displayEmpty:!0,children:$.map((e=>(0,s.jsx)(v.A,{value:e.id,children:e.name},e.id)))})}),(0,s.jsx)(A.A,{variant:"outlined",onClick:()=>{B&&(ie(B),ne(B))},children:"Refresh"})]})]})}),(0,s.jsx)(h.Ay,{item:!0,xs:12,children:(0,s.jsx)(h.Ay,{container:!0,spacing:2.5,children:se.map((e=>(0,s.jsx)(h.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,s.jsx)(j.A,{onClick:e.onClick,sx:{background:z.A.thirdColor,boxShadow:"0px 0px 14px rgba(0, 0, 0, 0.14)",borderRadius:"12px",minHeight:140,display:"flex",alignItems:"center",cursor:"pointer",transition:"transform 0.15s ease","&:hover":{transform:"translateY(-4px)"}},children:(0,s.jsxs)(m.A,{sx:{width:"100%"},children:[(0,s.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,s.jsx)(u.A,{color:"#7c7c7c",fontSize:"14px",children:e.title}),(0,s.jsx)(p.A,{sx:{background:z.A.firstColor,color:"white",borderRadius:"8px"},size:"small",children:"revenue"===e.key?(0,s.jsx)(l.A,{}):"guestRatings"===e.key?(0,s.jsx)(r,{}):(0,s.jsx)(i.A,{})})]}),(0,s.jsxs)(c.A,{display:"flex",gap:2,alignItems:"center",mt:1,children:["guestRatings"===e.key?(0,s.jsx)(x.A,{size:"small",sx:{minWidth:160},children:(0,s.jsx)(g.A,{size:"small",value:J,onChange:oe,onClick:e=>e.stopPropagation(),children:$.map((e=>(0,s.jsx)(v.A,{value:e.id,children:e.name},e.id)))})}):null,(0,s.jsx)(u.A,{variant:"h5",fontWeight:600,children:e.value})]}),(0,s.jsxs)(u.A,{mt:2,display:"flex",alignItems:"center",gap:1,sx:{color:e.change.includes("-")?"red":"green",width:"fit-content",px:2,borderRadius:"4px",border:"solid 1px",fontSize:"14px"},children:[e.change.includes("-")?(0,s.jsx)(a.A,{}):(0,s.jsx)(d.A,{})," ",e.change," from last week"]}),(0,s.jsx)(u.A,{mt:1,color:"#7c7c7c",fontSize:"12px",children:(0,s.jsx)("em",{children:e.hoverText})})]})})},e.key)))})}),(0,s.jsx)(h.Ay,{item:!0,xs:12,children:(0,s.jsx)(j.A,{sx:{background:z.A.thirdColor,borderRadius:2},children:(0,s.jsxs)(m.A,{children:[(0,s.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,s.jsx)(u.A,{fontWeight:"bold",variant:"h6",children:"Upcoming Bookings"}),(0,s.jsx)(u.A,{color:"textSecondary",children:null!==(e=null===(t=$.find((e=>e.id===B)))||void 0===t?void 0:t.name)&&void 0!==e?e:"\u2014"})]}),B&&(0,s.jsx)(N.A,{bookings:F[B]||[],hotelId:B,onCheckIn:async e=>{var t;if(!B)return;t=F[B];H((t=>{const n={...t};return n[B]=(n[B]||[]).map((t=>t.id===e?{...t,status:"checkedin"}:t)),n}))},onCheckOut:async e=>{var t;if(!B)return;t=F[B];H((t=>{const n={...t};return n[B]=(n[B]||[]).map((t=>t.id===e?{...t,status:"checkedout"}:t)),n}))}})]})})}),(0,s.jsx)(h.Ay,{item:!0,xs:12,md:6,children:(0,s.jsx)(j.A,{sx:{background:z.A.firstColor,color:"white",borderRadius:2,padding:2,height:300},children:(0,s.jsxs)(m.A,{sx:{p:0,height:"100%"},children:[(0,s.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,s.jsx)(u.A,{fontWeight:"bold",variant:"h6",children:"Booking Overview"}),(0,s.jsx)(x.A,{sx:{width:"fit-content",color:"white"},children:(0,s.jsx)(g.A,{size:"small",value:"Last 6 Months",children:(0,s.jsx)(v.A,{value:"Last 6 Months",children:"Last 6 Months"})})})]}),(0,s.jsx)(c.A,{sx:{height:"220px"},children:(0,s.jsx)(y.u,{width:"100%",height:"100%",children:(0,s.jsxs)(k.b,{data:G,children:[(0,s.jsx)(w.d,{strokeDasharray:"3 3",stroke:"white"}),(0,s.jsx)(C.W,{dataKey:"name",stroke:"white",style:{fontSize:10}}),(0,s.jsx)(S.h,{stroke:"white",style:{fontSize:10}}),(0,s.jsx)(I.m,{contentStyle:{backgroundColor:z.A.firstColor,border:"solid 1.5px white",borderRadius:4,color:"white"}}),(0,s.jsx)(R.N,{type:"monotone",dataKey:"revenue",stroke:"white",strokeWidth:3,dot:{r:6}})]})})})]})})}),(0,s.jsx)(h.Ay,{item:!0,xs:12,md:6,children:(0,s.jsx)(j.A,{sx:{background:z.A.firstColor,color:"white",borderRadius:2,padding:2,height:300},children:(0,s.jsxs)(m.A,{sx:{p:0,height:"100%"},children:[(0,s.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,s.jsx)(u.A,{fontWeight:"bold",variant:"h6",children:"Revenue"}),(0,s.jsx)(x.A,{sx:{width:"fit-content",color:"white"},children:(0,s.jsx)(g.A,{size:"small",value:"Last 6 Months",children:(0,s.jsx)(v.A,{value:"Last 6 Months",children:"Last 6 Months"})})})]}),(0,s.jsx)(c.A,{sx:{height:"220px"},children:(0,s.jsx)(y.u,{width:"100%",height:"100%",children:(0,s.jsxs)(k.b,{data:G,children:[(0,s.jsx)(w.d,{strokeDasharray:"3 3",stroke:"white"}),(0,s.jsx)(C.W,{dataKey:"name",stroke:"white",style:{fontSize:10}}),(0,s.jsx)(S.h,{stroke:"white",style:{fontSize:10}}),(0,s.jsx)(I.m,{contentStyle:{backgroundColor:z.A.firstColor,border:"solid 1.5px white",borderRadius:4,color:"white"}}),(0,s.jsx)(R.N,{type:"monotone",dataKey:"revenue",stroke:"white",strokeWidth:3,dot:{r:6}})]})})})]})})}),(0,s.jsx)(h.Ay,{item:!0,xs:12,children:(0,s.jsx)(j.A,{sx:{borderRadius:2},children:(0,s.jsxs)(m.A,{children:[(0,s.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[(0,s.jsx)(u.A,{fontWeight:"bold",variant:"h6",children:"Guest Reviews"}),(0,s.jsxs)(c.A,{display:"flex",alignItems:"center",gap:2,children:[(0,s.jsx)(u.A,{color:"textSecondary",children:null!==(n=null===(o=$.find((e=>e.id===B)))||void 0===o?void 0:o.name)&&void 0!==n?n:"\u2014"}),(0,s.jsx)(u.A,{color:"textSecondary",children:Z[B]?`${Z[B].count} reviews \u2022 ${Z[B].avg}/5`:"No reviews"})]})]}),(0,s.jsx)(f.A,{sx:{mb:2}}),Q[B]&&0!==Q[B].length?(0,s.jsx)(c.A,{display:"flex",flexDirection:"column",gap:2,children:Q[B].map((e=>{var t,n,i;return(0,s.jsx)(c.A,{sx:{p:2,borderRadius:1,background:z.A.thirdColor},children:(0,s.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,s.jsxs)(c.A,{display:"flex",gap:2,alignItems:"center",children:[(0,s.jsx)(b.A,{src:e.userAvatar||void 0}),(0,s.jsxs)(c.A,{children:[(0,s.jsx)(u.A,{fontWeight:700,children:null!==(t=null!==(n=e.userName)&&void 0!==n?n:e.userId)&&void 0!==t?t:"Guest"}),(0,s.jsx)(u.A,{fontSize:12,color:"textSecondary",children:e.comment?e.comment.length>120?e.comment.substring(0,120)+"...":e.comment:"No comment"})]})]}),(0,s.jsxs)(c.A,{textAlign:"right",children:[(0,s.jsxs)(u.A,{fontWeight:700,children:[Number(null!==(i=e.rating)&&void 0!==i?i:0).toFixed(1)," / 5"]}),(0,s.jsx)(u.A,{fontSize:12,color:"textSecondary",children:e.createdAt?M()(e.createdAt).format("DD MMM YYYY, hh:mm A"):"-"})]})]})},e.id)}))}):(0,s.jsx)(u.A,{color:"textSecondary",children:"No reviews for this hotel."})]})})})]})})}}}]);
//# sourceMappingURL=912.60e10feb.chunk.js.map