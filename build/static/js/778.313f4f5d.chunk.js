"use strict";(self.webpackChunkhuts4u=self.webpackChunkhuts4u||[]).push([[778],{87778:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var i=n(65043),o=n(83462),r=n(26600),l=n(35316),s=n(7353),a=n(94496),d=n(76641),c=n(11906),u=n(81637),x=n(68903),h=n(12110),g=n(26494),m=n(39336),v=n(59662),p=n(70579);const f=(0,v.A)((0,p.jsx)("path",{d:"m18 22-.01-6L14 12l3.99-4.01L18 2H6v6l4 4-4 3.99V22zM8 7.5V4h8v3.5l-4 4z"}),"HourglassBottom");var A=n(33580),b=n(67809),y=n(59628),j=n(69995),k=n(57488);const C=e=>{let{open:t,handleClose:n,selectedCard:x,onSubmit:h}=e;const[g,m]=(0,i.useState)((null===x||void 0===x?void 0:x.rating)||0),[v,f]=(0,i.useState)((null===x||void 0===x?void 0:x.reviewText)||""),[y,j]=(0,i.useState)(!1);(0,i.useEffect)((()=>{m((null===x||void 0===x?void 0:x.rating)||0),f((null===x||void 0===x?void 0:x.reviewText)||"")}),[x]);return(0,p.jsxs)(o.A,{open:t,onClose:n,fullWidth:!0,maxWidth:"sm",children:[(0,p.jsxs)(r.A,{sx:{fontWeight:700},children:["Review - ",(null===x||void 0===x?void 0:x.hotelName)||(null===x||void 0===x?void 0:x.title)||"Booking"]}),(0,p.jsx)(l.A,{children:(0,p.jsxs)(s.A,{display:"flex",flexDirection:"column",gap:2,mt:1,children:[(0,p.jsx)(a.A,{children:"Rate your experience:"}),(0,p.jsx)(d.A,{value:g,onChange:(e,t)=>m(t||0),size:"large"}),(0,p.jsx)(b.XY,{sx:{"& .MuiInputBase-input":{resize:"vertical"},"& textarea":{resize:"vertical"},"& .MuiOutlinedInput-root":{"& fieldset":{border:"none",borderRadius:"12px"}}},label:"Write your review",multiline:!0,rows:4,fullWidth:!0,value:v,onChange:e=>f(e.target.value)}),(0,p.jsxs)(s.A,{display:"flex",justifyContent:"flex-end",gap:2,children:[(0,p.jsx)(c.A,{onClick:n,variant:"outlined",sx:{textTransform:"none",borderRadius:"44px"},children:"Cancel"}),(0,p.jsx)(c.A,{onClick:async()=>{if(x){j(!0);try{await h(x.id,g,v),n()}finally{j(!1)}}},variant:"contained",sx:{background:A.A.firstColor,color:"white",textTransform:"none",borderRadius:"44px",px:3},disabled:y,children:y?(0,p.jsx)(u.A,{size:20,color:"inherit"}):"Submit Review"})]})]})})]})},I=()=>{const[e,t]=(0,i.useState)([]),[n,o]=(0,i.useState)(!1),[r,l]=(0,i.useState)(null),[v,b]=(0,i.useState)(!1),I=e=>{if(!e&&0!==e)return"\u20b90.00";let t=Number(e);return!isNaN(t)&&Math.abs(t)>1e3&&(t/=100),isNaN(t)?String(e):t.toLocaleString("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2})},S=e=>{const t=(e=>{try{if(!e)return null;if(e.checkInDateTime){const t=new Date(e.checkInDateTime);if(!isNaN(t.getTime()))return t}if(e.checkInDate){const t=String(e.checkInDate).replace(/[\u2018\u2019\u201C\u201D]/g,"'").trim(),n=e.checkInTime?String(e.checkInTime).trim():"",i=[`${t} ${n}`,`${t}T${n}`,t];for(const e of i){if(!e)continue;const t=new Date(e);if(!isNaN(t.getTime()))return t}const o=`${t.replace(/\u2019|\u2018|\u2019/g,"")} ${n}`.replace(/[\u2018\u2019\u201C\u201D]/g,""),r=new Date(o);if(!isNaN(r.getTime()))return r}return null}catch{return null}})(e);if(!t)return!1;const n=new Date;return t.getTime()-n.getTime()>864e5};(0,i.useEffect)((()=>{(async()=>{b(!0);try{var e,n;const i={data:{filter:"",userId:(0,y.F6)()},page:0,pageSize:50,order:[["createdAt","DESC"]]},o=await(0,j.Gc)(i),r=(null===o||void 0===o||null===(e=o.data)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.rows)||[];t(r)}catch(i){console.error("Failed to load bookings",i),k.oR.error("Failed to load bookings")}finally{b(!1)}})()}),[]),(0,i.useEffect)((()=>{if(!e||!e.length)return;const t=e.find((e=>"checkedOut"===String(e.status)&&(void 0===e.rating||null===e.rating)));t&&(l(t),o(!0))}),[e]);return v?(0,p.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",py:6},children:(0,p.jsx)(u.A,{})}):(0,p.jsxs)(s.A,{sx:{background:A.A.thirdColor,px:{xs:2,md:4},py:4},children:[(0,p.jsx)(a.A,{variant:"h4",fontWeight:"bold",sx:{textAlign:"center",color:A.A.firstColor,mb:2},children:"Your Bookings"}),(0,p.jsxs)(x.Ay,{container:!0,spacing:2,children:[0===e.length&&(0,p.jsx)(x.Ay,{item:!0,xs:12,children:(0,p.jsx)(s.A,{sx:{textAlign:"center",py:6},children:(0,p.jsx)(a.A,{sx:{color:"#666"},children:"No bookings yet."})})}),e.map(((e,n)=>{var i,r,u,v,b;const C=S(e);return(0,p.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,p.jsx)(h.A,{sx:{margin:"auto",mt:2,p:{xs:2,md:3},boxShadow:"0px 8px 28px rgba(0,0,0,0.12)",borderRadius:"12px",border:`1px solid ${A.A.firstColor}`,position:"relative"},children:(0,p.jsxs)(g.A,{sx:{p:0},children:[(0,p.jsx)(s.A,{sx:{position:"absolute",top:{xs:8,md:8},right:{xs:16,md:16},background:"checked in"===e.status||"checked out"===e.status?"green":"pending"===e.status?"#faaf00":"red",color:"white",px:1,borderRadius:{xs:"6px",md:"8px"},py:.5,display:"flex",alignItems:"center",gap:1,fontSize:"12px",textTransform:"capitalize"},children:e.status}),(0,p.jsx)(a.A,{variant:"h6",sx:{fontWeight:700,mb:.5},children:(null===e||void 0===e?void 0:e.hotelName)||(null===e||void 0===e?void 0:e.propertyName)||(null===e||void 0===e?void 0:e.title)}),(0,p.jsxs)(a.A,{color:"textSecondary",sx:{fontSize:13},children:[null===e||void 0===e?void 0:e.checkInDate," ",null!==e&&void 0!==e&&e.checkInTime?`, ${e.checkInTime}`:""," ",null!==e&&void 0!==e&&e.guestName?`\xb7 ${e.guestName}`:""]}),(0,p.jsxs)(a.A,{sx:{mt:1},children:[null!==(r=null===e||void 0===e?void 0:e.adults)&&void 0!==r?r:1," Adults",null!==e&&void 0!==e&&e.children?`, ${e.children} Child`:""]}),(0,p.jsx)(a.A,{variant:"h6",sx:{mt:1},children:I(null!==(u=null!==(v=null===e||void 0===e?void 0:e.amountPaid)&&void 0!==v?v:null===e||void 0===e?void 0:e.amount)&&void 0!==u?u:0)}),(0,p.jsx)(m.A,{sx:{my:1.5,borderStyle:"dashed",borderColor:"grey"}}),"checkedOut"===e.status&&(0,p.jsxs)(s.A,{display:"flex",alignItems:"center",gap:2,mt:1,flexWrap:"wrap",children:[(0,p.jsx)(c.A,{sx:{background:"transparent",border:"solid 2px",color:A.A.firstColor,borderColor:A.A.firstColor,borderRadius:"44px",textTransform:"none"},onClick:()=>(e=>{l(e),o(!0)})(e),children:e.rating?"Edit Review":"Add Review"}),(0,p.jsx)(d.A,{value:null!==(b=e.rating)&&void 0!==b?b:0,readOnly:!0,size:"small"})]}),"pending"===e.status&&(0,p.jsxs)(s.A,{display:"flex",alignItems:"flex-start",mt:2,color:"#faaf00",children:[(0,p.jsx)(f,{}),(0,p.jsxs)(s.A,{sx:{ml:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[(0,p.jsx)(a.A,{children:"Upcoming"}),(0,p.jsx)(c.A,{sx:{background:"transparent",border:"solid 2px",color:A.A.firstColor,borderColor:A.A.firstColor,borderRadius:"44px",textTransform:"none",ml:2},onClick:()=>(async e=>{if(console.log(e),!S(e))return void k.oR.info("Bookings can only be cancelled more than 24 hours before check-in.");const n=e.status;t((t=>t.map((t=>t.id===e.id?{...t,status:"cancelled"}:t))));try{const t={paymentId:e.paymentId,amount:e.amountPaid};(0,j.WD)(t).then((t=>{var n;const i={userId:(0,y.F6)(),hotelId:e.hotelId,bookingId:e.id,amount:e.ammountpaid,refundAmount:e.ammountpaid,reason:"Guest requested cancellation",status:"pending",refundres:null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.refund,processedBy:1,refundedAt:"2025-12-04T08:00:00.000Z",currency:"INR"};(0,j.ik)(e.id,{status:"Cancel"}).then((e=>{k.oR.success("Booking cancelled"),(0,j.xd)(i).then((e=>{k.oR.success("Booking cancelled")}))}))})).catch((e=>{console.log(e)}))}catch(i){t((t=>t.map((t=>t.id===e.id?{...t,status:n}:t)))),k.oR.error("Failed to cancel booking. Please try again.")}})(e),disabled:!C,children:"Cancel"})]})]}),"cancelled"===e.status&&(0,p.jsx)(s.A,{mt:2,color:"red",children:(0,p.jsx)(a.A,{children:"Booking Cancelled"})})]})})},null!==(i=e.id)&&void 0!==i?i:n)}))]}),r&&(0,p.jsx)(C,{open:n,handleClose:()=>{o(!1),l(null)},selectedCard:r,onSubmit:async(n,i,o)=>{t((e=>e.map((e=>String(e.id)===String(n)?{...e,rating:i,reviewText:o}:e))));try{const r=e.find((e=>String(e.id)===String(n))),l={userId:(0,y.F6)(),hotelId:(null===r||void 0===r?void 0:r.hotelId)||(null===r||void 0===r?void 0:r.hotelId)||(null===r||void 0===r?void 0:r.hotelId),bookingId:n,rating:Number(i),comment:o||""},s=await(0,j.GS)(l);if(null!==s&&void 0!==s&&s.data){const e=s.data;t((t=>t.map((t=>{var r,l;return String(t.id)===String(n)?{...t,rating:null!==(r=e.rating)&&void 0!==r?r:i,reviewText:null!==(l=e.comment)&&void 0!==l?l:o,hasRated:!0}:t}))))}k.oR.success("Thanks for your review!")}catch(r){console.error("Failed to submit rating:",r),t((e=>e.map((e=>String(e.id)===String(n)?{...e,rating:void 0,reviewText:void 0}:e)))),k.oR.error((null===r||void 0===r?void 0:r.message)||"Failed to submit review. Please try again.")}}})]})}}}]);
//# sourceMappingURL=778.313f4f5d.chunk.js.map